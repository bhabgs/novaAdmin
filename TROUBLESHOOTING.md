# åŠ¨æ€è·¯ç”±æ•…éšœæ’æŸ¥æŒ‡å—

## ğŸ” èœå•é…ç½®åè·¯ç”±ä¸ç”Ÿæ•ˆï¼Ÿ

### å·²ä¿®å¤çš„é—®é¢˜

**é—®é¢˜æè¿°**: åœ¨èœå•ç®¡ç†ä¸­æ·»åŠ ã€ä¿®æ”¹æˆ–åˆ é™¤èœå•åï¼Œè·¯ç”±æ²¡æœ‰ç«‹å³æ›´æ–°ã€‚

**æ ¹æœ¬åŸå› **: èœå•æ“ä½œååªåˆ·æ–°äº†ç®¡ç†åˆ—è¡¨ï¼ˆ`fetchMenus`ï¼‰ï¼Œæ²¡æœ‰åˆ·æ–°ç”¨æˆ·è·¯ç”±èœå•ï¼ˆ`fetchUserMenus`ï¼‰ã€‚

**è§£å†³æ–¹æ¡ˆ**: âœ… å·²ä¿®å¤

ç°åœ¨èœå•çš„å¢åˆ æ”¹æ“ä½œä¼šè‡ªåŠ¨åŒæ—¶åˆ·æ–°ï¼š
- ç®¡ç†èœå•åˆ—è¡¨ï¼ˆç”¨äºèœå•ç®¡ç†é¡µé¢ï¼‰
- ç”¨æˆ·è·¯ç”±èœå•ï¼ˆç”¨äºåŠ¨æ€è·¯ç”±ç”Ÿæˆï¼‰

---

## ğŸš€ å¿«é€Ÿè§£å†³æ–¹æ³•

### æ–¹æ³• 1: ä½¿ç”¨åˆ·æ–°è·¯ç”±æŒ‰é’®ï¼ˆæ¨èï¼‰

åœ¨ **èœå•ç®¡ç†** é¡µé¢å³ä¸Šè§’ï¼Œç‚¹å‡» **"åˆ·æ–°è·¯ï¿½ï¿½"** æŒ‰é’®ã€‚

```
èœå•ç®¡ç† â†’ [åˆ·æ–°è·¯ç”±] æŒ‰é’®
```

è¿™ä¼šç«‹å³é‡æ–°è·å–èœå•æ•°æ®å¹¶æ›´æ–°è·¯ç”±ã€‚

### æ–¹æ³• 2: åˆ·æ–°é¡µé¢

æŒ‰ `F5` æˆ– `Ctrl/Cmd + R` åˆ·æ–°æµè§ˆå™¨é¡µé¢ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨é‡æ–°åŠ è½½ç”¨æˆ·èœå•ã€‚

### æ–¹æ³• 3: é‡æ–°ç™»å½•

é€€å‡ºç™»å½•åé‡æ–°ç™»å½•ï¼Œä¼šé‡æ–°è·å–æœ€æ–°çš„èœå•é…ç½®ã€‚

---

## ğŸ› å¸¸è§é—®é¢˜æ’æŸ¥

### 1. èœå•æ·»åŠ åè·¯ç”±404

**ç—‡çŠ¶**: æ·»åŠ äº†æ–°èœå•ï¼Œä½†è®¿é—®å¯¹åº”è·¯å¾„æ˜¾ç¤º 404ã€‚

**æ’æŸ¥æ­¥éª¤**:

#### Step 1: æ£€æŸ¥èœå•é…ç½®

æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°ï¼ˆF12ï¼‰ï¼ŒæŸ¥çœ‹ï¼š

```javascript
// æŸ¥çœ‹ç”¨æˆ·èœå•
console.log(store.getState().menu.userMenus);
```

ç¡®è®¤ï¼š
- âœ… æ–°èœå•æ˜¯å¦åœ¨åˆ—è¡¨ä¸­
- âœ… `type` å­—æ®µæ˜¯ `"page"`ï¼ˆä¸æ˜¯ `"directory"` æˆ– `"button"`ï¼‰
- âœ… `status` å­—æ®µæ˜¯ `"active"`
- âœ… `path` å­—æ®µæ­£ç¡®ï¼ˆå¦‚ `"/new-page"`ï¼‰
- âœ… `component` å­—æ®µæ­£ç¡®ï¼ˆå¦‚ `"NewPage"`ï¼‰

#### Step 2: æ£€æŸ¥ç»„ä»¶æ˜¯å¦æ³¨å†Œ

æŸ¥çœ‹ `src/router/componentMap.tsx`ï¼Œç¡®è®¤ç»„ä»¶å·²æ³¨å†Œï¼š

```tsx
export const componentMap = {
  // ...
  NewPage: lazy(() => import('../pages/NewPage')),  // â† æ˜¯å¦å­˜åœ¨ï¼Ÿ
};
```

**å¦‚æœæ²¡æœ‰æ³¨å†Œ**:
1. æ·»åŠ ç»„ä»¶åˆ° `componentMap.tsx`
2. ç‚¹å‡» "åˆ·æ–°è·¯ç”±" æŒ‰é’®

#### Step 3: æŸ¥çœ‹è·¯ç”±ç”Ÿæˆæ—¥å¿—

æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°ï¼ŒæŸ¥çœ‹è·¯ç”±ç”Ÿæˆæ—¥å¿—ï¼š

```
[generateRoutes] Processing menus: 10 menus
[generateRoutes] âœ“ Generating route: new-page -> NewPage
```

**å¦‚æœçœ‹åˆ°è­¦å‘Š**:
```
[generateRoutes] âœ— Component "NewPage" not found for menu: æ–°åŠŸèƒ½
```
è¯´æ˜ç»„ä»¶æœªåœ¨ `componentMap` ä¸­æ³¨å†Œã€‚

---

### 2. ç»„ä»¶æ‰¾ä¸åˆ°è­¦å‘Š

**ç—‡çŠ¶**: æ§åˆ¶å°æ˜¾ç¤º `Component "XXX" not found`

**åŸå› **: èœå•é…ç½®çš„ `component` å­—æ®µä¸ `componentMap` ä¸åŒ¹é…ã€‚

**è§£å†³æ–¹æ³•**:

1. **æ£€æŸ¥æ‹¼å†™**: ç»„ä»¶ååŒºåˆ†å¤§å°å†™
   ```json
   // âœ… æ­£ç¡®
   { "component": "UserList" }

   // âŒ é”™è¯¯
   { "component": "userlist" }
   { "component": "Userlist" }
   ```

2. **æ£€æŸ¥æ˜¯å¦æ³¨å†Œ**: æŸ¥çœ‹ `componentMap.tsx`
   ```tsx
   // å·²æ³¨å†Œçš„ç»„ä»¶
   import { getRegisteredComponents } from '@/router/utils';
   console.log(getRegisteredComponents());
   ```

3. **æ·»åŠ æ–°ç»„ä»¶**:
   ```tsx
   // src/router/componentMap.tsx
   NewPage: lazy(() => import('../pages/NewPage')),
   ```

---

### 3. è·¯ç”±ç”Ÿæˆä½†æ— æƒé™è®¿é—®

**ç—‡çŠ¶**: è·¯ç”±å­˜åœ¨ï¼Œä½†ç”¨æˆ·è®¿é—®æ—¶è·³è½¬åˆ° 404 æˆ–é¦–é¡µã€‚

**åŸå› **: æƒé™æ§åˆ¶é—®é¢˜ã€‚

**æ’æŸ¥æ­¥éª¤**:

1. **æ£€æŸ¥èœå•çŠ¶æ€**:
   ```json
   { "status": "active" }  // âœ… å¿…é¡»æ˜¯ active
   ```

2. **æ£€æŸ¥ç”¨æˆ·è§’è‰²**: ç¡®è®¤å½“å‰ç”¨æˆ·æœ‰æƒé™è®¿é—®è¯¥èœå•

3. **æ£€æŸ¥è·¯ç”±å®ˆå«**: å¦‚æœä½¿ç”¨äº† `PermissionRoute`ï¼Œç¡®è®¤æƒé™é…ç½®

---

### 4. åµŒå¥—è·¯ç”±ä¸ç”Ÿæ•ˆ

**ç—‡çŠ¶**: çˆ¶å­è·¯ç”±é…ç½®é”™è¯¯ï¼Œå­è·¯ç”±æ— æ³•è®¿é—®ã€‚

**æ­£ç¡®é…ç½®**:

```json
{
  "id": "100",
  "type": "directory",
  "name": "å·¥å…·",
  "children": [
    {
      "id": "101",
      "type": "page",
      "path": "/util/editor",      // âœ… å®Œæ•´è·¯å¾„
      "component": "Editor"
    },
    {
      "id": "102",
      "type": "page",
      "path": "/util/viewer",      // âœ… å®Œæ•´è·¯å¾„
      "component": "Viewer"
    }
  ]
}
```

**é”™è¯¯é…ç½®**:

```json
{
  "type": "directory",
  "path": "/util",              // âŒ directory ä¸åº”è¯¥æœ‰ path
  "children": [
    {
      "path": "editor",         // âŒ å­è·¯ç”±åº”è¯¥æ˜¯å®Œæ•´è·¯å¾„
      "component": "Editor"
    }
  ]
}
```

---

### 5. åŠ¨æ€å‚æ•°è·¯ç”±é—®é¢˜

**ç—‡çŠ¶**: å¸¦å‚æ•°çš„è·¯ç”±ï¼ˆå¦‚ `/users/detail/:id`ï¼‰æ— æ³•è®¿é—®ã€‚

**æ£€æŸ¥é¡¹**:

1. **è·¯å¾„æ ¼å¼**: ä½¿ç”¨ `:` å‰ç¼€è¡¨ç¤ºå‚æ•°
   ```json
   { "path": "/users/detail/:id" }  // âœ… æ­£ç¡®
   { "path": "/users/detail/{id}" } // âŒ é”™è¯¯
   ```

2. **åœ¨ç»„ä»¶ä¸­è·å–å‚æ•°**:
   ```tsx
   import { useParams } from 'react-router-dom';

   const UserDetail = () => {
     const { id } = useParams();
     return <div>ç”¨æˆ· ID: {id}</div>;
   };
   ```

---

## ğŸ”§ è°ƒè¯•æŠ€å·§

### 1. æŸ¥çœ‹è·¯ç”±ç”Ÿæˆè¿‡ç¨‹

æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°ï¼Œä¼šçœ‹åˆ°è¯¦ç»†çš„è·¯ç”±ç”Ÿæˆæ—¥å¿—ï¼š

```
[DynamicRoutes] Generating routes, userMenus: [...]
[generateRoutes] Processing menus: 10 menus
[generateRoutes] âœ“ Generating route: dashboard -> Dashboard
[generateRoutes] âœ“ Generating route: users -> UserList
[DynamicRoutes] Generated dynamic children: [...]
```

### 2. æ£€æŸ¥ Redux çŠ¶æ€

ä½¿ç”¨ Redux DevTools æŸ¥çœ‹çŠ¶æ€ï¼š

```javascript
// èœå•çŠ¶æ€
state.menu.menus        // ç®¡ç†èœå•åˆ—è¡¨
state.menu.userMenus    // ç”¨æˆ·è·¯ç”±èœå•
state.menu.loading      // åŠ è½½çŠ¶æ€

// è®¤è¯çŠ¶æ€
state.auth.isAuthenticated
state.auth.user
```

### 3. æ‰‹åŠ¨è§¦å‘èœå•åˆ·æ–°

åœ¨æµè§ˆå™¨æ§åˆ¶å°æ‰§è¡Œï¼š

```javascript
import store from '@/store';
import { fetchUserMenus } from '@/store/slices/menuSlice';

store.dispatch(fetchUserMenus());
```

### 4. æ¸…é™¤ç¼“å­˜

å¦‚æœè·¯ç”±ä¸€ç›´ä¸æ›´æ–°ï¼Œå°è¯•ï¼š

1. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜
2. æ¸…é™¤ localStorage: `localStorage.clear()`
3. ç¡¬åˆ·æ–°: `Ctrl/Cmd + Shift + R`

---

## ğŸ“‹ è‡ªæ£€æ¸…å•

é…ç½®æ–°èœå•å‰ï¼Œç¡®è®¤ä»¥ä¸‹äº‹é¡¹ï¼š

- [ ] é¡µé¢ç»„ä»¶å·²åˆ›å»ºï¼ˆ`src/pages/xxx`ï¼‰
- [ ] ç»„ä»¶å·²åœ¨ `componentMap.tsx` ä¸­æ³¨å†Œ
- [ ] èœå• `type` è®¾ç½®ä¸º `"page"`
- [ ] èœå• `status` è®¾ç½®ä¸º `"active"`
- [ ] èœå• `path` æ ¼å¼æ­£ç¡®ï¼ˆå¦‚ `"/new-page"`ï¼‰
- [ ] èœå• `component` ä¸ `componentMap` ä¸­çš„é”®åå®Œå…¨ä¸€è‡´
- [ ] é…ç½®ä¿å­˜åç‚¹å‡»äº† "åˆ·æ–°è·¯ç”±" æŒ‰é’®

---

## ğŸ†˜ ä»ç„¶æ— æ³•è§£å†³ï¼Ÿ

### å®Œæ•´é‡ç½®æµç¨‹

1. **é€€å‡ºç™»å½•**
2. **æ¸…é™¤ç¼“å­˜**:
   ```javascript
   localStorage.clear();
   sessionStorage.clear();
   ```
3. **ç¡¬åˆ·æ–°é¡µé¢**: `Ctrl/Cmd + Shift + R`
4. **é‡æ–°ç™»å½•**
5. **åœ¨èœå•ç®¡ç†é¡µé¢ç‚¹å‡» "åˆ·æ–°è·¯ç”±"**

### æŸ¥çœ‹å®Œæ•´æ—¥å¿—

1. æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°ï¼ˆF12ï¼‰
2. åˆ‡æ¢åˆ° Console æ ‡ç­¾
3. åˆ·æ–°é¡µé¢
4. æŸ¥æ‰¾ä»¥ä¸‹å…³é”®ä¿¡æ¯ï¼š
   - `[DynamicRoutes]` å¼€å¤´çš„æ—¥å¿—
   - `[generateRoutes]` å¼€å¤´çš„æ—¥å¿—
   - ä»»ä½•è­¦å‘Šæˆ–é”™è¯¯ä¿¡æ¯

### æäº¤ Issue

å¦‚æœé—®é¢˜ä¾ç„¶å­˜åœ¨ï¼Œè¯·æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š

1. **èœå•é…ç½®**:
   ```javascript
   console.log(JSON.stringify(store.getState().menu.userMenus, null, 2));
   ```

2. **è·¯ç”±ç”Ÿæˆæ—¥å¿—**: æ§åˆ¶å°å®Œæ•´è¾“å‡º

3. **ç»„ä»¶æ³¨å†Œæƒ…å†µ**:
   ```javascript
   import { getRegisteredComponents } from '@/router/utils';
   console.log(getRegisteredComponents());
   ```

4. **æµè§ˆå™¨å’Œç‰ˆæœ¬**: å¦‚ Chrome 120

5. **å¤ç°æ­¥éª¤**: è¯¦ç»†è¯´æ˜å¦‚ä½•é‡ç°é—®é¢˜

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [åŠ¨æ€è·¯ç”±ä½¿ç”¨æŒ‡å—](./DYNAMIC_ROUTING.md)
- [æŠ€æœ¯æ–‡æ¡£](./src/router/README.md)
- [ç»„ä»¶æ˜ å°„è¡¨](./src/router/componentMap.tsx)

---

## âœ¨ æœ€ä½³å®è·µ

1. **æ¯æ¬¡ä¿®æ”¹èœå•å**: ç‚¹å‡» "åˆ·æ–°è·¯ç”±" æŒ‰é’®
2. **æ·»åŠ æ–°é¡µé¢æ—¶**: å…ˆæ³¨å†Œç»„ä»¶ï¼Œå†é…ç½®èœå•
3. **æµ‹è¯•è·¯ç”±**: é…ç½®åç«‹å³è®¿é—®æµ‹è¯•
4. **æŸ¥çœ‹æ—¥å¿—**: é‡åˆ°é—®é¢˜å…ˆçœ‹æ§åˆ¶å°æ—¥å¿—
5. **ä¿æŒä¸€è‡´**: ç»„ä»¶åå’Œèœå•é…ç½®ä¿æŒä¸€è‡´

---

ç°åœ¨ä½ çš„åŠ¨æ€è·¯ç”±ç³»ç»Ÿåº”è¯¥å¯ä»¥æ­£å¸¸å·¥ä½œäº†ï¼ğŸ‰
