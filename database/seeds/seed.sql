-- Nova Admin 种子数据
-- 运行: psql -U postgres -d nova_admin -f seed.sql

-- 清空现有数据 (如果表存在)
DO $$
BEGIN
    TRUNCATE TABLE sys_role_menu, sys_user_role, sys_operation_log, sys_i18n, sys_config, sys_menu_closure, sys_menu, sys_role, sys_user, sys_department_closure, sys_department CASCADE;
EXCEPTION
    WHEN undefined_table THEN
        -- 表不存在，跳过清空操作
        NULL;
END $$;

-- 部门数据
INSERT INTO sys_department (id, name, code, parent_id, leader, phone, email, status, sort, created_at, updated_at) VALUES
('00000000-0000-0000-0000-000000000001', '总公司', 'HQ', NULL, '张总', '13800000001', 'hq@nova.com', 1, 1, NOW(), NOW()),
('00000000-0000-0000-0000-000000000002', '技术部', 'TECH', '00000000-0000-0000-0000-000000000001', '李经理', '13800000002', 'tech@nova.com', 1, 1, NOW(), NOW()),
('00000000-0000-0000-0000-000000000003', '产品部', 'PRODUCT', '00000000-0000-0000-0000-000000000001', '王经理', '13800000003', 'product@nova.com', 1, 2, NOW(), NOW()),
('00000000-0000-0000-0000-000000000004', '运营部', 'OPS', '00000000-0000-0000-0000-000000000001', '赵经理', '13800000004', 'ops@nova.com', 1, 3, NOW(), NOW());

-- 部门闭包表数据 (TypeORM closure-table 格式)
INSERT INTO sys_department_closure (id_ancestor, id_descendant) VALUES
-- 每个节点到自己的关系
('00000000-0000-0000-0000-000000000001', '00000000-0000-0000-0000-000000000001'),
('00000000-0000-0000-0000-000000000002', '00000000-0000-0000-0000-000000000002'),
('00000000-0000-0000-0000-000000000003', '00000000-0000-0000-0000-000000000003'),
('00000000-0000-0000-0000-000000000004', '00000000-0000-0000-0000-000000000004'),
-- 总公司到子部门的关系
('00000000-0000-0000-0000-000000000001', '00000000-0000-0000-0000-000000000002'),
('00000000-0000-0000-0000-000000000001', '00000000-0000-0000-0000-000000000003'),
('00000000-0000-0000-0000-000000000001', '00000000-0000-0000-0000-000000000004');

-- 角色数据
INSERT INTO sys_role (id, name, code, description, status, sort, created_at, updated_at) VALUES
('10000000-0000-0000-0000-000000000001', '超级管理员', 'SUPER_ADMIN', '拥有所有权限', 1, 1, NOW(), NOW()),
('10000000-0000-0000-0000-000000000002', '管理员', 'ADMIN', '系统管理员', 1, 2, NOW(), NOW()),
('10000000-0000-0000-0000-000000000003', '普通用户', 'USER', '普通用户权限', 1, 3, NOW(), NOW());

-- 用户数据 (密码: 123456, bcrypt加密)
INSERT INTO sys_user (id, username, password, nickname, email, phone, status, department_id, created_at, updated_at) VALUES
('20000000-0000-0000-0000-000000000001', 'admin', '$2b$10$ItH0diwka2ytGAc.qPWrfuQ3c6bNzO8bjXHPIqNqmJWmk6JFIutHi', '超级管理员', 'admin@nova.com', '13800000000', 1, '00000000-0000-0000-0000-000000000001', NOW(), NOW()),
('20000000-0000-0000-0000-000000000002', 'test', '$2b$10$ItH0diwka2ytGAc.qPWrfuQ3c6bNzO8bjXHPIqNqmJWmk6JFIutHi', '测试用户', 'test@nova.com', '13800000001', 1, '00000000-0000-0000-0000-000000000002', NOW(), NOW());

-- 用户角色关联
INSERT INTO sys_user_role (user_id, role_id) VALUES
('20000000-0000-0000-0000-000000000001', '10000000-0000-0000-0000-000000000001'),
('20000000-0000-0000-0000-000000000002', '10000000-0000-0000-0000-000000000003');

-- 菜单数据
INSERT INTO sys_menu (id, parent_id, name, name_i18n, path, component, icon, type, permission, sort, visible, status, created_at, updated_at) VALUES
-- 一级菜单
('30000000-0000-0000-0000-000000000001', NULL, '仪表盘', 'menu.dashboard', '/dashboard', 'pages/dashboard/index', 'LayoutDashboard', 2, NULL, 1, true, 1, NOW(), NOW()),
('30000000-0000-0000-0000-000000000002', NULL, '系统管理', 'menu.system', '/system', NULL, 'Settings', 1, NULL, 2, true, 1, NOW(), NOW()),
-- 系统管理子菜单
('30000000-0000-0000-0000-000000000003', '30000000-0000-0000-0000-000000000002', '用户管理', 'menu.user', '/system/user', 'pages/system/user/index', 'Users', 2, 'system:user:list', 1, true, 1, NOW(), NOW()),
('30000000-0000-0000-0000-000000000004', '30000000-0000-0000-0000-000000000002', '角色管理', 'menu.role', '/system/role', 'pages/system/role/index', 'Shield', 2, 'system:role:list', 2, true, 1, NOW(), NOW()),
('30000000-0000-0000-0000-000000000005', '30000000-0000-0000-0000-000000000002', '部门管理', 'menu.department', '/system/department', 'pages/system/department/index', 'Building2', 2, 'system:department:list', 3, true, 1, NOW(), NOW()),
('30000000-0000-0000-0000-000000000006', '30000000-0000-0000-0000-000000000002', '菜单管理', 'menu.menu', '/system/menu', 'pages/system/menu/index', 'Menu', 2, 'system:menu:list', 4, true, 1, NOW(), NOW());

-- 菜单闭包表数据 (TypeORM closure-table 格式)
INSERT INTO sys_menu_closure (id_ancestor, id_descendant) VALUES
-- 每个节点到自己的关系
('30000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000001'),
('30000000-0000-0000-0000-000000000002', '30000000-0000-0000-0000-000000000002'),
('30000000-0000-0000-0000-000000000003', '30000000-0000-0000-0000-000000000003'),
('30000000-0000-0000-0000-000000000004', '30000000-0000-0000-0000-000000000004'),
('30000000-0000-0000-0000-000000000005', '30000000-0000-0000-0000-000000000005'),
('30000000-0000-0000-0000-000000000006', '30000000-0000-0000-0000-000000000006'),
-- 系统管理到子菜单的关系
('30000000-0000-0000-0000-000000000002', '30000000-0000-0000-0000-000000000003'),
('30000000-0000-0000-0000-000000000002', '30000000-0000-0000-0000-000000000004'),
('30000000-0000-0000-0000-000000000002', '30000000-0000-0000-0000-000000000005'),
('30000000-0000-0000-0000-000000000002', '30000000-0000-0000-0000-000000000006');

-- 角色菜单关联 (超级管理员拥有所有菜单)
INSERT INTO sys_role_menu (role_id, menu_id) VALUES
('10000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000001'),
('10000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000002'),
('10000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000003'),
('10000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000004'),
('10000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000005'),
('10000000-0000-0000-0000-000000000001', '30000000-0000-0000-0000-000000000006'),
-- 普通用户只有仪表盘
('10000000-0000-0000-0000-000000000003', '30000000-0000-0000-0000-000000000001');

-- 系统配置
INSERT INTO sys_config (id, key, value, type, description, created_at, updated_at) VALUES
('40000000-0000-0000-0000-000000000001', 'site.name', 'Nova Admin', 'string', '站点名称', NOW(), NOW()),
('40000000-0000-0000-0000-000000000002', 'site.logo', '/logo.png', 'string', '站点Logo', NOW(), NOW()),
('40000000-0000-0000-0000-000000000003', 'user.defaultPassword', '123456', 'string', '用户默认密码', NOW(), NOW());

-- 国际化数据
INSERT INTO sys_i18n (id, key, zh_CN, en_US, ar_SA, module, created_at, updated_at) VALUES
('50000000-0000-0000-0000-000000000001', 'menu.dashboard', '仪表盘', 'Dashboard', 'لوحة القيادة', 'menu', NOW(), NOW()),
('50000000-0000-0000-0000-000000000002', 'menu.system', '系统管理', 'System', 'النظام', 'menu', NOW(), NOW()),
('50000000-0000-0000-0000-000000000003', 'menu.user', '用户管理', 'Users', 'المستخدمون', 'menu', NOW(), NOW()),
('50000000-0000-0000-0000-000000000004', 'menu.role', '角色管理', 'Roles', 'الأدوار', 'menu', NOW(), NOW()),
('50000000-0000-0000-0000-000000000005', 'menu.department', '部门管理', 'Departments', 'الأقسام', 'menu', NOW(), NOW()),
('50000000-0000-0000-0000-000000000006', 'menu.menu', '菜单管理', 'Menus', 'القوائم', 'menu', NOW(), NOW());

-- 字典类型数据
INSERT INTO sys_dict_type (id, name, code, description, status, sort, created_at, updated_at) VALUES
('60000000-0000-0000-0000-000000000001', '国际化模块', 'i18n_module', '国际化配置的模块分类', 1, 1, NOW(), NOW()),
('60000000-0000-0000-0000-000000000002', '用户状态', 'user_status', '用户启用禁用状态', 1, 2, NOW(), NOW()),
('60000000-0000-0000-0000-000000000003', '菜单类型', 'menu_type', '菜单类型：目录、菜单、按钮', 1, 3, NOW(), NOW());

-- 字典项数据 - 国际化模块
INSERT INTO sys_dict_item (id, dict_type_code, label, value, description, status, sort, created_at, updated_at) VALUES
('61000000-0000-0000-0000-000000000001', 'i18n_module', '基础模块', 'common', '通用基础翻译', 1, 1, NOW(), NOW()),
('61000000-0000-0000-0000-000000000002', 'i18n_module', '菜单模块', 'menu', '菜单相关翻译', 1, 2, NOW(), NOW()),
('61000000-0000-0000-0000-000000000003', 'i18n_module', '用户模块', 'user', '用户管理翻译', 1, 3, NOW(), NOW()),
('61000000-0000-0000-0000-000000000004', 'i18n_module', '角色模块', 'role', '角色管理翻译', 1, 4, NOW(), NOW()),
('61000000-0000-0000-0000-000000000005', 'i18n_module', '部门模块', 'department', '部门管理翻译', 1, 5, NOW(), NOW()),
('61000000-0000-0000-0000-000000000006', 'i18n_module', '权限模块', 'rbac', '权限管理翻译', 1, 6, NOW(), NOW()),
('61000000-0000-0000-0000-000000000007', 'i18n_module', '系统模块', 'system', '系统设置翻译', 1, 7, NOW(), NOW()),
('61000000-0000-0000-0000-000000000008', 'i18n_module', '认证模块', 'auth', '登录认证翻译', 1, 8, NOW(), NOW());

-- 字典项数据 - 用户状态
INSERT INTO sys_dict_item (id, dict_type_code, label, value, description, status, sort, created_at, updated_at) VALUES
('61000000-0000-0000-0000-000000000011', 'user_status', '禁用', '0', '用户禁用状态', 1, 1, NOW(), NOW()),
('61000000-0000-0000-0000-000000000012', 'user_status', '启用', '1', '用户启用状态', 1, 2, NOW(), NOW());

-- 字典项数据 - 菜单类型
INSERT INTO sys_dict_item (id, dict_type_code, label, value, description, status, sort, created_at, updated_at) VALUES
('61000000-0000-0000-0000-000000000021', 'menu_type', '目录', '0', '菜单目录', 1, 1, NOW(), NOW()),
('61000000-0000-0000-0000-000000000022', 'menu_type', '菜单', '1', '菜单项', 1, 2, NOW(), NOW()),
('61000000-0000-0000-0000-000000000023', 'menu_type', '按钮', '2', '操作按钮', 1, 3, NOW(), NOW());
