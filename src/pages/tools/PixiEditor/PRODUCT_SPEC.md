# PixiJS 图形编辑器产品文档

## 1. 产品概述

### 1.1 产品定位
基于 PixiJS 的高性能 2D 图形编辑器，专注于流程图、管道图和工业图表的创建与编辑。

### 1.2 核心价值
- **高性能渲染**：基于 WebGL 的硬件加速渲染
- **专业管道系统**：支持复杂管道连接和动画效果
- **直观操作体验**：所见即所得的编辑界面
- **丰富的交互功能**：贝塞尔曲线编辑、实时预览等

## 2. 功能规格

### 2.1 基础图形功能

#### 2.1.1 图形创建
- **矩形**：支持圆角、填充、描边
- **圆形/椭圆**：可调节长短轴比例
- **线条**：直线、折线、自由绘制
- **文本**：多字体、多样式、富文本支持
- **多边形**：自定义顶点数量和形状

#### 2.1.2 图形属性编辑
- **位置属性**：X、Y 坐标，支持精确数值输入
- **尺寸属性**：宽度、高度，支持比例锁定
- **外观属性**：
  - 填充色：纯色、渐变、纹理
  - 描边：颜色、宽度、样式（实线、虚线）
  - 透明度：0-100% 可调
  - 阴影：偏移、模糊、颜色
- **变换属性**：旋转、缩放、倾斜
- **层级属性**：图层顺序、锁定、可见性

### 2.2 图层树结构

#### 2.2.1 层级管理
- **树形结构显示**：清晰展示所有图形元素的层级关系
- **拖拽排序**：支持图层间的拖拽重新排序
- **分组功能**：支持多个图形组合成组，统一操作
- **命名管理**：自定义图层名称，支持搜索过滤

#### 2.2.2 图层操作
- **显示/隐藏**：一键切换图层可见性
- **锁定/解锁**：防止误操作的锁定功能
- **复制/粘贴**：支持图层的复制和粘贴
- **删除操作**：安全删除确认机制

### 2.3 管道系统（核心功能）

#### 2.3.1 管道创建
- **智能连接**：自动识别图形的连接点
- **连接点类型**：
  - 输入点：接收连接的端点
  - 输出点：发出连接的端点
  - 双向点：可输入可输出的端点
- **连接规则**：定义哪些类型的点可以相互连接

#### 2.3.2 管道样式
- **线条样式**：
  - 粗细：1-20px 可调
  - 颜色：支持渐变色
  - 样式：实线、虚线、点线
  - 端点样式：箭头、圆点、方块
- **管道类型**：
  - 直线管道：最短路径连接
  - 折线管道：90度转角连接
  - 曲线管道：平滑贝塞尔曲线

#### 2.3.3 贝塞尔曲线编辑
- **控制点显示**：可视化的控制点操作
- **实时预览**：拖拽时实时显示曲线变化
- **桥形效果**：
  - 自动检测管道交叉
  - 生成桥形跨越效果
  - 可调节桥形高度和宽度
- **曲线类型**：
  - 二次贝塞尔曲线：单控制点
  - 三次贝塞尔曲线：双控制点
  - 样条曲线：多点平滑连接

#### 2.3.4 管道动画
- **流动效果**：
  - 粒子流动：模拟液体流动
  - 虚线移动：虚线沿管道移动
  - 渐变流动：颜色渐变沿管道流动
- **动画参数**：
  - 流动速度：可调节流动快慢
  - 流动方向：正向、反向、双向
  - 粒子密度：控制粒子数量
  - 动画循环：无限循环或指定次数

#### 2.3.5 智能连接
- **自动吸附**：拖拽时自动吸附到最近的连接点
- **连接反馈**：高亮显示可连接的点
- **连接验证**：检查连接的有效性
- **动态更新**：图形移动时管道自动跟随

### 2.4 交互功能

#### 2.4.1 选择操作
- **单选**：点击选择单个图形
- **多选**：Ctrl+点击或框选多个图形
- **全选**：Ctrl+A 全选所有图形
- **反选**：反向选择功能

#### 2.4.2 编辑操作
- **拖拽移动**：直接拖拽图形移动位置
- **缩放操作**：拖拽控制点调整大小
- **旋转操作**：旋转手柄调整角度
- **复制粘贴**：Ctrl+C/V 快速复制

#### 2.4.3 撤销重做
- **操作历史**：记录所有编辑操作
- **撤销功能**：Ctrl+Z 撤销上一步操作
- **重做功能**：Ctrl+Y 重做已撤销的操作
- **历史面板**：可视化的操作历史列表

### 2.5 视图控制

#### 2.5.1 缩放功能
- **鼠标滚轮缩放**：平滑的缩放体验
- **缩放比例显示**：实时显示当前缩放比例
- **适应窗口**：一键适应画布到窗口大小
- **实际大小**：快速回到100%显示比例

#### 2.5.2 平移功能
- **拖拽平移**：按住空格键拖拽平移画布
- **导航器**：小地图导航功能
- **居中显示**：快速居中显示所有内容

## 3. 技术架构

### 3.1 技术栈
- **前端框架**：React 18 + TypeScript
- **渲染引擎**：PixiJS 7.x
- **UI 组件库**：Ant Design
- **状态管理**：React Hooks + Context
- **样式方案**：Less + CSS Modules

### 3.2 核心模块

#### 3.2.1 渲染引擎 (PixiEngine)
```typescript
class PixiEngine {
  // 应用实例管理
  private app: PIXI.Application
  
  // 图形对象管理
  private objects: Map<string, GraphicObject>
  
  // 管道系统管理
  private pipes: Map<string, Pipe>
  
  // 连接点管理
  private connectionPoints: Map<string, ConnectionPoint>
}
```

#### 3.2.2 图形对象系统
```typescript
abstract class GraphicObject {
  id: string
  type: ObjectType
  properties: ObjectProperties
  connectionPoints: ConnectionPoint[]
  
  abstract render(): PIXI.DisplayObject
  abstract updateProperties(props: Partial<ObjectProperties>): void
}
```

#### 3.2.3 管道系统
```typescript
class Pipe {
  id: string
  startPoint: ConnectionPoint
  endPoint: ConnectionPoint
  style: PipeStyle
  bezierPoints: BezierPoint[]
  animation?: PipeAnimation
  
  render(): PIXI.Graphics
  updatePath(): void
  startAnimation(): void
}
```

#### 3.2.4 连接点系统
```typescript
class ConnectionPoint {
  id: string
  parentObject: GraphicObject
  position: Point
  type: ConnectionType
  
  canConnectTo(other: ConnectionPoint): boolean
  getWorldPosition(): Point
}
```

### 3.3 数据流架构

```
用户操作 → 事件处理 → 状态更新 → 渲染引擎 → 视图更新
    ↑                                           ↓
    ← 反馈信息 ← 操作结果 ← 引擎响应 ← 渲染完成 ←
```

## 4. 用户界面设计

### 4.1 布局结构
```
┌─────────────────────────────────────────────────────────┐
│                    工具栏 (Toolbar)                      │
├─────────┬─────────────────────────────────┬─────────────┤
│         │                                 │             │
│  图层   │                                 │   属性      │
│  面板   │           画布区域               │   面板      │
│         │        (Canvas Area)            │             │
│ (Layer  │                                 │(Property    │
│ Panel)  │                                 │ Panel)      │
│         │                                 │             │
├─────────┴─────────────────────────────────┴─────────────┤
│                    状态栏 (Status Bar)                   │
└─────────────────────────────────────────────────────────┘
```

### 4.2 工具栏设计
- **图形工具组**：矩形、圆形、线条、文本等
- **选择工具组**：选择、移动、缩放、旋转
- **管道工具组**：创建管道、编辑贝塞尔、动画设置
- **视图工具组**：缩放、平移、适应窗口
- **操作工具组**：撤销、重做、复制、粘贴

### 4.3 属性面板设计
- **基础属性**：位置、尺寸、旋转、透明度
- **外观属性**：填充、描边、阴影、渐变
- **管道属性**：样式、动画、连接设置
- **高级属性**：图层混合、滤镜效果

## 5. 实现计划

### 5.1 第一阶段：基础框架 (1-2周)
- [ ] 搭建 PixiJS 基础架构
- [ ] 实现基础图形创建
- [ ] 完成图层树结构
- [ ] 基础属性编辑功能

### 5.2 第二阶段：管道系统 (2-3周)
- [ ] 连接点系统实现
- [ ] 基础管道创建和连接
- [ ] 管道样式编辑
- [ ] 智能连接功能

### 5.3 第三阶段：高级功能 (2-3周)
- [ ] 贝塞尔曲线编辑器
- [ ] 管道交叉桥形效果
- [ ] 管道动画系统
- [ ] 性能优化

### 5.4 第四阶段：完善优化 (1-2周)
- [ ] 用户体验优化
- [ ] 性能测试和优化
- [ ] 文档完善
- [ ] 测试用例编写

## 6. 性能指标

### 6.1 渲染性能
- **帧率要求**：60 FPS 稳定运行
- **对象数量**：支持 1000+ 图形对象
- **管道数量**：支持 500+ 管道连接
- **内存占用**：< 200MB

### 6.2 响应性能
- **操作响应**：< 16ms (60fps)
- **文件加载**：< 2s (中等复杂度文件)
- **导出速度**：< 5s (高清图片导出)

## 7. 扩展性设计

### 7.1 插件系统
- **工具插件**：自定义绘图工具
- **图形插件**：自定义图形类型
- **导出插件**：多格式导出支持
- **主题插件**：自定义界面主题

### 7.2 API 接口
- **图形操作 API**：创建、编辑、删除图形
- **管道操作 API**：创建、编辑管道连接
- **文件操作 API**：保存、加载、导出
- **事件监听 API**：监听用户操作事件

## 8. 质量保证

### 8.1 测试策略
- **单元测试**：核心功能模块测试
- **集成测试**：模块间交互测试
- **性能测试**：渲染性能和内存测试
- **用户测试**：真实用户使用反馈

### 8.2 代码质量
- **TypeScript**：类型安全保证
- **ESLint**：代码规范检查
- **Prettier**：代码格式化
- **代码审查**：团队代码审查流程

---

*本文档将随着开发进度持续更新和完善*